
/Users/eugene/MyProjects/baonline/scripts/get_messages.py

✦ Этот скрипт на Python, bao_tg_importer.py, представляет собой инструмент
  для импорта сообщений из Telegram в базу данных Supabase.

  Вот его основные функции:
   1. Подключение к Telegram: Скрипт использует библиотеку telethon для
      подключения к вашему аккаунту Telegram с помощью API ID, API Hash и
      сессионной строки.

   2. Взаимодействие с Supabase: Он подключается к вашему проекту Supabase,
      используя URL и ключ доступа.

   3. Синхронизация каналов:
       * Скрипт получает список Telegram-каналов для синхронизации из таблицы
         channel_sync_state в вашей базе данных Supabase.
       * Для каждого канала он отслеживает ID последнего обработанного сообщения,
         чтобы не импортировать дубликаты.

   4. Обработка сообщений:
       * Он запрашивает новые сообщения из указанных каналов (поддерживаются как
         обычные каналы, так и каналы-форумы с топиками).
       * Обрабатываются только сообщения, содержащие текст.

   5. Классификация с помощью AI (Ollama):
       * Ключевая особенность: Каждое текстовое сообщение отправляется на локально
         запущенный AI-сервис (Ollama) для классификации.
       * AI определяет, является ли сообщение "событием" (вероятно, на основе
         наличия конкретной даты в тексте). Промпт для этой задачи загружается из
         файла ollama_prompt.md.

   6. Сохранение данных:
       * Обработанные сообщения, включая их содержимое, дату публикации, ссылку на
         оригинальный пост и результат AI-классификации (is_event), сохраняются в
         таблицу posts в Supabase.

   7. Обновление состояния: После успешного сохранения сообщений из канала, скрипт
      обновляет last_processed_message_id в таблице channel_sync_state, чтобы при
      следующем запуске начать с новых сообщений.

  В итоге, этот скрипт автоматизирует процесс сбора сообщений из Telegram, их
  анализа с помощью локальной нейросети на предмет наличия событий и последующего
  сохранения структурированных данных в базу Supabase.