# Логика работы: Скрипт vs Промпт

В данном проекте обязанности по обработке данных строго разделены между программным кодом (Python) и искусственным интеллектом (Ollama).

## 1. За что отвечает ПРОМПТ (Интеллект)
Промпт — это «мозг» системы. Он работает на этапе анализа текста сообщения.

- **Классификация:** Определение, является ли сообщение событием (`is_event`).
- **Извлечение сущностей:** Поиск в тексте даты, времени, места проведения, цены и валюты.
- **Смысловая обработка:** Создание лаконичного заголовка (`title`) на основе контекста.
- **Категоризация:** Присвоение ID категории (Еда, Спорт, Культура и т.д.).
- **Форматирование:** Упаковка данных в строгий JSON-массив (поддержка нескольких дат в одном посте).

## 2. За что отвечает СКРИПТ (Автоматизация)
Скрипт — это «тело» системы. Он отвечает за техническую реализацию и соблюдение стандартов базы данных.

- **Сбор данных:** Авторизация в Telegram, отслеживание состояния каналов, получение новых сообщений.
- **Работа с медиа:** Скачивание изображений из постов и их загрузка в Supabase Storage (бакет `events`).
- **Санитария данных (Sanitize):**
    - Приведение типов: извлечение только чисел из строковых цен (для типа `integer`).
    - Исправление URL: автоматическая замена пробелов на `+` в ссылках на карты.
    - Обработка NULL: замена `null` на пустые строки для обязательных полей (NOT NULL).
- **Системные поля:** Добавление UUID автора, ссылок на посты, ID города и технических флагов (`isAuto`).
- **Синхронизация:** Одновременная запись данных в таблицы `posts` и `events`.

## Итог
- Хотите изменить **критерии поиска** событий? Редактируйте `unified_ollama_prompt.md`.
- Хотите изменить **структуру базы данных** или способ хранения фото? Редактируйте скрипты в папке `scripts/`.
